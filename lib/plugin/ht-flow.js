!function(W){"use strict";var c=W.ht,H=c.Default,r=H.getInternal(),l=r.ui(),w=null,g="__segmentLengths",q="__lineTotalLength",y="__linePoints",n="__distance0",i="flow.count",G="flow.step",F="flow.element.max",$="flow.element.count",Z="flow.element.min",d="flow.element.space",_="flow.element.autorotate",L="flow.element.background",s="flow.element.shadow.max",O="flow.element.shadow.min",K="flow.element.shadow.begincolor",m="flow.element.shadow.endcolor",o="flow.element.shadow.visible",f="flow.element.image",B="flow",z=c.Math.Vector2,P=new z;new z,new z,c.List;var u=c.Default._edgeProtectMethod,R=u.getStraightLinePoints,h=function(n,l){for(var R=[],d=n.length,p=0;d>p;p++){var q=n[p];q._as&&(q=q._as);for(var C=q[0],b=1;b<q.length;b++)R.push([C,q[b]]),C=q[b]}for(var y=[],p=0;p<R.length;p++){var u=T(R[p][0],R[p][1],l);y.push(u)}return{distance:y,segments:R}},v=function(A,E,_){if(A){for(var Z,k=h(A,E),e=k.distance,b=k.segments,i=1/0,l=null,M=0,s=e.length;s>M;M++){var n=e[M];n.z<i&&(Z=M,i=n.z,l=n)}if(null==_&&(_=.1),l.z<_){for(var m=0,x=0;Z>=x;x++)m+=H.getDistance(b[x][0],Z>x?b[x][1]:l);return m}}},T=function(v,I,Q){var m=v.x,A=v.y,r=I.x,H=I.y,i=Q.x,D=Q.y,O=r-m,W=H-A,d=Math.sqrt(O*O+W*W),n=O/d,c=W/d,l=(-m+i)*n+(-A+D)*c,f={x:m+l*n,y:A+l*c};return f.x>=Math.min(v.x,I.x)&&f.x<=Math.max(v.x,I.x)&&f.y>=Math.min(v.y,I.y)&&f.y<=Math.max(v.y,I.y)||(f.x=Math.abs(f.x-v.x)<Math.abs(f.x-I.x)?v.x:I.x,f.y=Math.abs(f.y-v.y)<Math.abs(f.y-I.y)?v.y:I.y),O=i-f.x,W=D-f.y,f.z=Math.sqrt(O*O+W*W),f},U=function(A,e){if(A){var j=h(A,e).distance,s=1/0,v=null;return j.forEach(function(V){V.z<s&&(s=V.z,v=V)}),v}},Q=u.calculateLineLength,S=u.calcSegmentIndexByDistance,E=u.calculatePointAlongLine,e=function(J,L,s){if(!J)return s;if(0===L){var b=J[0][0],Z=J[0][1];return s+Math.atan2(Z.y-b.y,Z.x-b.x)}if(100===L){J=J[J.length-1];var b=J[J.length-2],Z=J[J.length-1];return s+Math.atan2(Z.y-b.y,Z.x-b.x)}for(var c=0,l=[],x=J.length,m=0;x>m;m++){var h=J[m],I=Q(h);c+=I,l.push(I)}for(var z=c*L/100,X=S(z,l),B=0,R=0;X>R;R++)B+=l[R];z-=B;for(var V=E(J[X],z),v=J[X],w=0,q=0,C=0;C<v.length-1;C++){var r=v[C],D=v[C+1],M=D.x-r.x,f=D.y-r.y,u=Math.sqrt(M*M+f*f);if(w+=u,w>z){q=C;break}}var N=v[q];return s+Math.atan2(V.y-N.y,V.x-N.x)},p=function(f){var d=0;if(f)if(Array.isArray(f[0]))for(var h=f.length,g=0;h>g;g++){var N=f[g],Z=Q(N);d+=Z}else d=Q(f);return d},Y=function(X,s,F,v){return P.set(s,F).rotateAround(null,v),X?{x:X.x+P.x,y:X.y+P.y}:{x:P.x,y:P.y}},b=function(S){var X=S._data,i=R(S);if(i){X.s("flow.reverse")&&(i.reverse(),i.forEach(function(P){P.reverse()}));for(var z=0,U=[],w=i.length,b=0;w>b;b++){var K=i[b],k=Q(K);z+=k,U.push(k)}if(X[g]=U,X[q]=z,X[y]=i,X instanceof c.Edge){var J=H.unionPoint(i),A=J.x+J.width/2,P=J.y+J.height/2;X.$10e={x:A,y:P}}x(S,!0)}},J=u.getPercentPosition,x=function(U,j){var N=U._data,c=N[q],x=N.s(i),p=N.s(G),R=0,u=N[g],w=N.s(F),H=N.s(Z),W=N.s($),y=(w-H)/(W-1),A=[];if(u){if(1===W)A.push(w);else if(2===W)A.push(w),A.push(H);else{if(!(W>2))return;A.push(w);for(var O=W-2;O>0;O--)A.push(H+y*O);A.push(H)}var K=0,P=0;A.forEach(function(H){W-1>K&&(P+=N.getFlowElementSpace(H)),K++}),P+=(w+H)/2,R=(c-x*P+P)/x;var v=U[n];for(null==v&&(v=0),j||(v+=p);v>c+P;){var h=U._overCount;h?h++:h=1,h>=x&&(h=null),U._overCount=h,N.s("flow.autoreverse")?h?v-=R+P:(v=0,N.s("flow.reverse",!N.s("flow.reverse"))):v-=R+P}U[n]=v}},M="prototype",D=c.graph.GraphView[M],I=c.Data[M],C=l.DataUI[M],N=l.ShapeUI[M],X=l.EdgeUI[M],a=c.DataModel[M],k=c.Style;k[F]==w&&(k[F]=7),k[Z]==w&&(k[Z]=0),k[i]==w&&(k[i]=1),k[G]==w&&(k[G]=3),k[$]==w&&(k[$]=10),k[d]==w&&(k[d]=3.5),k[_]==w&&(k[_]=!1),k[L]==w&&(k[L]="rgba(255, 255, 114, 0.4)"),k[K]==w&&(k[K]="rgba(255, 255, 0, 0.3)"),k[m]==w&&(k[m]="rgba(255, 255, 0, 0)"),k[o]==w&&(k[o]=1),k[s]==w&&(k[s]=22),k[O]==w&&(k[O]=4),D.calculatePointLength=function(U,H,x){var B=this.getDataUI(U),g=R(B);return v(g,H,x)},H.calculatePointLength=function(_,B,M,u){var Y=R(w,_,B);return v(Y,M,u)},H.calculateClosestPointOnLine=T,D.calculateClosestPoint=function(H,m){var t=this.getDataUI(H),O=R(t);return U(O,m)},H.calculateClosestPoint=function(A,V,Z){var u=R(w,A,V);return U(u,Z)},D.getPercentAngle=function(j,Q){var K=this.getDataUI(j),g=R(K);return j.getRotation?j.getRotation():0,e(g,Q,j.getRotation?j.getRotation():0)},H.getPercentAngle=function(D,$,L){var l=R(w,D,$);return e(l,L,0)},D.calculateLength=function(e){var W=this.getDataUI(e),M=R(W);return p(M)},H.calculateLength=function(c,U){var N=R(w,c,U);return p(N)},D.getPercentPosition=function(O,T){var H=this.getDataUI(O),P=R(H);return J(P,T)},H.getPercentPositionOnPoints=function(D,L,T){var l=R(w,D,L);return J(l,T)};var j=function(b){var G=b.data,M=this.dm();if(G&&"add"===b.kind){var $=M.$3e;$&&G.s(B)&&$.indexOf(G)<0&&$.push(G)}"clear"===b.kind&&(M.$3e=[])},t=function(p){var R=p.property,o=p.data,G=p.newValue,s=this.dm().$3e;if(s&&"s:flow"===R)if(G)s.indexOf(o)<0&&s.push(o);else for(var T=s.length,d=0;T>d;d++)if(s[d]===o){s.splice(d,1);break}},V=D.setDataModel;D.setDataModel=function(M){var N=this,m=N._dataModel;if(m!==M){m&&(m.umm(j,N),m.umd(t,N),m.$3e=[]),M.mm(j,N),M.md(t,N);var W=M.$3e=[];M.each(function(I){I.s(B)&&W.indexOf(I)<0&&W.push(I)}),V.call(N,M)}},I.getFlowElementSpace=function(){return this.s(d)};var A=function(T){var o=this,h=o._data,U=h[q],N=h[g],b=h[y],M=h.s(i),l=0,x=o[n],m=h.s(F),r=h.s(Z),Q=h.s($),X=h.s(O),J=h.s(s),R=h.s(_),I=(J-X)/(Q-1),P=(m-r)/(Q-1),L=h.getRotation?h.getRotation():0,t=h.getPosition?h.p():h.$10e,d=[],c=[];if(x!=w){if(1===Q)d.push(m);else if(2===Q)d.push(m),d.push(r);else{if(!(Q>2))return;d.push(m);for(var D=Q-2;D>0;D--)d.push(r+P*D);d.push(r)}if(1===Q)c.push(J);else if(2===Q)c.push(J),c.push(X);else{if(!(Q>2))return;c.push(J);for(var D=Q-2;D>0;D--)c.push(X+I*D);c.push(X)}var K=0,W=0;d.forEach(function(u){Q-1>K&&(W+=h.getFlowElementSpace(u)),K++}),W+=(m+r)/2,l=(U-M*W+W)/M,T.save();for(var D=0;M>D;D++){var u=x,f=0,z=o._overCount,k=0;h.s("flow.autoreverse")&&z&&z>M-(D+1)||(u-=D*(l+W),K=0,d.forEach(function(e){var n=u-f;if(n>=0&&U>n){var w=!0,s=S(n,N);k=0;for(var M=0;s>M;M++)k+=N[M];if(n-=k,w){var $=E(b[s],n),Z=L;if(R){for(var j=b[s],G=0,p=0,Q=0;Q<j.length-1;Q++){var z=j[Q],v=j[Q+1],y=v.x-z.x,W=v.y-z.y,i=Math.sqrt(y*y+W*W);if(G+=i,G>n){p=Q;break}}var H=j[p];Z+=Math.atan2($.y-H.y,$.x-H.x)}L&&($=Y(t,$.x-t.x,$.y-t.y,L)),o.$5e(T,$,e,c[K],Z)}}f+=h.getFlowElementSpace(d[K]),K++}))}T.restore()}},ii=X._80o;X._80o=function(k){ii.call(this,k);var H=this,E=H._data,r=H.gv;E.s(B)&&r.$7e!=w&&A.call(H,k)};var Ic=N._80o;N._80o=function(k){Ic.call(this,k);var b=this,O=b._data,T=b.gv;O.s(B)&&T.$7e!=w&&A.call(b,k)};var ol=X._79o,hb=N._79o,zc=function(){var z=this,O=z._data,$=O.s(F),C=!1,P=w;if(z._6I||(C=!0),P=O instanceof c.Edge?ol.call(z):hb.call(z),O.s(B)&&C){var U=O.s(s),G=O.s(o);G&&U>$&&($=U),$>0&&H.grow(P,Math.ceil($/2)),b(z)}return!O.s(B)&&C&&(O[g]=O[q]=O[y]=z[n]=w),P};N._79o=zc,X._79o=zc,C.$5e=function(_,F,y,u,s){var Y=this,j=Y._data,l=Y.gv,R=j.s(L),c=j.s(K),J=j.s(m),Z=j.s(o),a=l.$8e,Q=j.s(f);if(a==w&&(a=l.$8e={}),_.beginPath(),Q!=w){var X=H.getImage(Q),i=y/2;_.translate(F.x,F.y),_.rotate(s),_.translate(-F.x,-F.y),H.drawImage(_,X,F.x-i,F.y-i,y,y,j),_.translate(F.x,F.y),_.rotate(-s),_.translate(-F.x,-F.y)}else if(l.__flowBatch){var N=l.__flowBatchGroup;N||(N=l.__flowBatchGroup={});var A=[F.x,F.y,y/2];N[R]?N[R].push(A):N[R]=[A]}else _.fillStyle=R,_.arc(F.x,F.y,y/2,0,2*Math.PI,!0),_.fill();if(Z){var d=22,I=d+"_"+c+"_"+J,T=a[I];if(T==w){var $=document.createElement("canvas");r.setCanvas($,d,d);var n=$.getContext("2d"),O=d/2,B=O,P=O;r.translateAndScale(n,0,0,1),n.beginPath();var G=n.createRadialGradient(B,P,0,B,B,O);G.addColorStop(0,c),G.addColorStop(1,J),n.fillStyle=G,n.arc(B,P,O,0,2*Math.PI,!0),n.fill(),T=a[I]=$}var i=u/2;H.drawImage(_,T,F.x-i,F.y-i,u,u,j)}},D.$9e=function(){var f=this,J=f.dm().$3e;f._24I,J.forEach(function(d){f._24I[d._id]=d}),f.iv()};var qp=a.prepareRemove;a.prepareRemove=function(t){qp.call(this,t);var m=t._dataModel,z=m.$3e;if(z)for(var X=z.length,c=0;X>c;c++)if(z[c]===t){z.splice(c,1);break}},D.setFlowInterval=function(j){var u=this,p=u.$11e;u.$11e=j,u.fp("flowInterval",p,j),u.$7e!=w&&(clearInterval(u.$7e),delete u.$7e,u.enableFlow(j))},D.getFlowInterval=function(){return this.$11e},D.enableFlow=function(Z){var l=this,F=l.dm(),V=F.$3e;l.$7e==w&&(V.forEach(function(U){var t=l.getDataUI(U);b(t)}),l.$7e=setInterval(function(){F.$3e.forEach(function(p){x(l.getDataUI(p))}),l.$9e()},Z||l.$11e||50))},D.disableFlow=function(){var I=this;clearInterval(I.$7e),delete I.$7e;var n=I.dm().$3e;n&&I.$9e()};var vr=function(){this.__flowBatchGroup={}},fs=function(u){var C=this.__flowBatchGroup;if(C){u.save();for(var J in C){u.fillStyle=J,u.beginPath();var n=C[J];n.forEach(function(f){u.moveTo(f[0],f[1]),u.arc(f[0],f[1],f[2],0,2*Math.PI,!0)}),u.fill()}u.restore()}};D.setFlowBatch=function(K){var d=this;!!d.__flowBatch!=!!K&&(d.__flowBatch=K,K?(d.addBottomPainter(vr),d.addTopPainter(fs)):(d.removeBottomPainter(vr),d.removeTopPainter(fs)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);