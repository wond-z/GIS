!function(y,m){"use strict";var H="ht",M=H+".layout.",S=y[H]||module.parent.exports.ht,h=S.List,X=S.DataModel,t=S.Node,f=S.Edge,e=S.Group,n=Math,l=n.sqrt,x=n.random,g=n.max,o=n.min,u=function(r){return r*r};S.Default.getInternal().addMSMap({ms_force:function(W){W._interval=50,W._stepCount=10,W._motionLimit=.01,W._edgeRepulsion=.65,W._nodeRepulsion=.65,W._damper=1,W._maxMotion=0,W._motionRatio=0,W.init=function(H){var f=this;H instanceof X?f.dm=H:f.gv=H,f._nodeMap={},f._nodes=new h,f._edges=new h},W.start=function(){var H=this,K=H.gv;if(!H._timer){var S=H.cdm=K?K.dm():H.dm;S.mm(H.handleDataModelChange,H),S.md(H.handleDataPropertyChange,H),K&&K.mp(H.handleGV,H),S.each(function(v){if(H.isVisible(v)&&H.isLayoutable(v)&&v instanceof t)if(H instanceof a){var I=v.p3();v.p3([I[0]+x(),I[1]+x(),I[2]+x()])}else I=v.p(),v.p(I.x+x(),I.y+x())}),H._timer=setInterval(function(){H.relax()},H._interval),H._damper=1}},W.stop=function(){var w=this;w._timer&&(w.cdm.umm(w.handleDataModelChange,w),w.cdm.umd(w.handleDataPropertyChange,w),w.gv&&w.gv.ump(w.handleGV,w),clearInterval(w._timer),delete w._timer,delete w.cdm)},W.handleGV=function(b){var l=this;if("dataModel"===b.property){var U=b.oldValue,Q=b.newValue;U&&(U.umm(l.handleDataModelChange,l),U.umd(l.handleDataPropertyChange,l)),this.cdm=Q,Q.mm(l.handleDataModelChange,l),Q.md(l.handleDataPropertyChange,l)}},W.relax=function(){var m=this;if(!(m._damper<.1&&m._maxMotion<m._motionLimit)){this.cdm.each(function($){m.isVisible($)&&($ instanceof f?m.addEdge($):$ instanceof t&&m.addNode($))});for(var C,X,d=0,F=m._edges,A=m._nodes,Y=A.size();d<m._stepCount;d++){for(F.each(m.relaxEdge,m),C=0;Y>C;C++)for(X=0;Y>X;X++)m.relaxNode(A.get(C),A.get(X));m.moveNode()}m._isAdjusting=1,A.each(function(n){n.fix||(n.p?n.v.p3(n.p):n.v.p(n.x,n.y))}),delete m._isAdjusting,m._nodeMap={},A.clear(),F.clear(),m.onRelaxed()}},W.onRelaxed=function(){},W.isRunning=function(){return!!this._timer},W.isVisible=function(m){return m.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(m):!0},W.isLayoutable=function(c){if(c.s("layoutable")===!1)return!1;if(c instanceof e)return!1;var H=this;return H.gv?H.gv.isMovable(c)&&!H.gv.isSelected(c):!(H.cdm||H.dm).sm().co(c)},W.getNodeRepulsion=function(){return this._nodeRepulsion},W.setNodeRepulsion=function(V){this._nodeRepulsion=V,this._damper=1},W.getEdgeRepulsion=function(){return this._edgeRepulsion},W.setEdgeRepulsion=function(A){this._edgeRepulsion=A,this._damper=1},W.getStepCount=function(){return this._stepCount},W.setStepCount=function(z){this._stepCount=z,this._damper=1},W.getInterval=function(){return this._interval},W.setInterval=function(f){var H=this;H._interval!==f&&(H._interval=f,H._timer&&(clearInterval(H._timer),H._timer=setInterval(function(){H.relax()},f)))},W.handleDataPropertyChange=function(c){!this._isAdjusting&&this.isVisible(c.data)&&(this._damper=1)},W.handleDataModelChange=function(){this._damper=1},W.damp=function(){var $=this._maxMotion,X=this._damper;this._motionRatio<=.001&&((.2>$||$>1&&.9>X)&&X>.01?this._damper-=.01:.4>$&&X>.003?this._damper-=.003:X>1e-4&&(this._damper-=1e-4)),$<this._motionLimit&&(this._damper=0)}}}),S.layout.ForceLayout=function(G){this.init(G)},S.Default.def(M+"ForceLayout",m,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(O){this._limitBounds=O,this._damper=1},getNodeSize:function(z){var O=this.gv;return O&&O.getDataUIBounds?O.getDataUIBounds(z):z.getRect()},addNode:function(P){var F=this,Y=F._nodeMap[P._id];if(Y)return Y;var K=P.p();Y={v:P,x:K.x,y:K.y,dx:0,dy:0,fix:!F.isLayoutable(P),s:F.getNodeSize(P)};var r=Y.s,z=l(u(r.width)+u(r.height))*F._nodeRepulsion;return Y.r=1>z?100:z,F._nodeMap[P._id]=Y,F._nodes.add(Y),Y},addEdge:function(c){if(c._40I&&c._41I){var I=this,m=I.addNode(c._40I),$=I.addNode(c._41I),u={s:m,t:$};$=$.s,m=m.s;var s=$.width+m.width,G=$.height+m.height;u.length=l(s*s+G*G)*I._edgeRepulsion,u.length<=0&&(u.length=100),I._edges.add(u)}},relaxEdge:function(o){var r=o.t,x=o.s,k=r.x-x.x,V=r.y-x.y,Z=l(k*k+V*V),j=100*o.length,t=.25*k/j*Z,A=.25*V/j*Z;r.dx=r.dx-t,r.dy=r.dy-A,x.dx=x.dx+t,x.dy=x.dy+A},relaxNode:function(i,b){if(i!==b){var G=0,$=0,L=i.x-b.x,O=i.y-b.y,o=L*L+O*O;0===o?(G=x(),$=x()):36e4>o&&(G=L/o,$=O/o);var q=i.r*b.r/400;G*=q,$*=q,i.dx+=G,i.dy+=$,b.dx-=G,b.dy-=$}},moveNode:function(){var j=this,L=j._limitBounds,u=j._maxMotion,M=0,H=j._damper;j._nodes.each(function(U){if(!U.fix){var K=U.dx*H,b=U.dy*H;if(U.dx=K/2,U.dy=b/2,M=g(l(K*K+b*b),M),U.x+=g(-40,o(40,K)),U.y+=g(-40,o(40,b)),L){U.x<L.x&&(U.x=L.x,j.adjust(1,0)),U.y<L.y&&(U.y=L.y,j.adjust(0,1));var J=U.s;U.x+J.width>L.x+L.width&&(U.x=L.x+L.width-J.width,j.adjust(-1,0)),U.y+J.height>L.y+L.height&&(U.y=L.y+L.height-J.height,j.adjust(0,-1))}}}),j._maxMotion=M,j._motionRatio=M>0?u/M-1:0,j.damp()},adjust:function(O,k){var Y=this._limitBounds;this._nodes.each(function($){O>0?(!Y||$.x+$.s.width+O<Y.x+Y.width)&&($.x+=O):(!Y||$.x+O>Y.x)&&($.x+=O),k>0?(!Y||$.y+$.s.height+k<Y.y+Y.height)&&($.y+=k):(!Y||$.y+k>Y.y)&&($.y+=k)})}});var a=S.layout.Force3dLayout=function(o){this.init(o)};S.Default.def(M+"Force3dLayout",m,{ms_force:1,getNodeSize3d:function(M){return M.s3()},addNode:function(z){var f=this,O=f._nodeMap[z._id];if(O)return O;O={v:z,p:z.p3(),d:[0,0,0],fix:!f.isLayoutable(z),s:f.getNodeSize3d(z)};var H=O.s,c=S.Default.getDistance(H)*f._nodeRepulsion;return O.r=1>c?100:c,f._nodeMap[z._id]=O,f._nodes.add(O),O},addEdge:function(T){if(T._40I&&T._41I){var C=this,w=C.addNode(T._40I),I=C.addNode(T._41I),m={s:w,t:I};I=I.s,w=w.s,m.length=l(u(I[0]+w[0])+u(I[1]+w[1])+u(I[2]+w[2]))*C._edgeRepulsion,m.length<=0&&(m.length=100),C._edges.add(m)}},relaxEdge:function(Z){var w=Z.t.p,A=Z.s.p,t=Z.t.d,N=Z.s.d,u=w[0]-A[0],P=w[1]-A[1],n=w[2]-A[2],o=l(u*u+P*P+n*n),h=100*Z.length,p=.25*u/h*o,q=.25*P/h*o,D=.25*n/h*o;t[0]-=p,t[1]-=q,t[2]-=D,N[0]+=p,N[1]+=q,N[2]+=D},relaxNode:function(h,N){if(h!==N){var Q=h.p,X=N.p,e=0,E=0,o=0,g=Q[0]-X[0],M=Q[1]-X[1],C=Q[2]-X[2],m=g*g+M*M+C*C;0===m?(e=x(),E=x(),o=x()):216e6>m&&(e=g/m,E=M/m,o=C/m);var n=h.r*N.r/400,H=h.d,p=N.d;e*=n,E*=n,o*=n,H[0]+=e,H[1]+=E,H[2]+=o,p[0]-=e,p[1]-=E,p[2]-=o}},moveNode:function(){var f=this,U=f._maxMotion,n=0,p=f._damper;f._nodes.each(function(U){if(!U.fix){var K=U.p,L=U.d,J=L[0]*p,x=L[1]*p,E=L[2]*p;L[0]=J/2,L[1]=x/2,L[2]=E/2,n=g(l(J*J+x*x+E*E),n),K[0]+=g(-40,o(40,J)),K[1]+=g(-40,o(40,x)),K[2]+=g(-40,o(40,E))}}),f._maxMotion=n,f._motionRatio=n>0?U/n-1:0,f.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);