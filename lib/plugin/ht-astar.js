!function(E,O,k){"use strict";var M=E.ht;M.Astar={},function(X){var P=X();E.AStar=P.astar,E.AStar.Graph=P.Graph}(function(){function S(r){for(var y=r,n=[];y.parent;)n.unshift(y),y=y.parent;return n}function U(){return new J(function(t){return t.f})}function G(F,g){g=g||{},this.nodes=[],this.diagonal=!!g.diagonal,this.grid=[];for(var C=0;C<F.length;C++){this.grid[C]=[];for(var u=0,p=F[C];u<p.length;u++){var y=new x(C,u,p[u]);this.grid[C][u]=y,this.nodes.push(y)}}this.$13x()}function x(A,G,N){this.x=A,this.y=G,this.weight=N}function J(f){this.content=[],this.scoreFunction=f}var C={search:function(H,k,E,q){H.$6x(),q=q||{};var O=q.heuristic;O||(O=H.diagonal?C.$4x.diagonal:C.$4x.manhattan);var t=q.closest||!1,M=q.punish,e=U(),Z=k;for(k.h=O(k,E),H.$7x(k),e.push(k);e.size()>0;){var b=e.pop();if(b===E)return S(b);b.closed=!0;for(var R=H.neighbors(b),L=0,X=R.length;X>L;++L){var x=R[L];if(!x.closed&&!x.$9x()){var h=b.g+x.getCost(b,M),f=x.visited;(!f||h<x.g)&&(x.visited=!0,x.parent=b,x.h=x.h||O(x,E),x.g=h,x.f=x.g+x.h,H.$7x(x),t&&(x.h<Z.h||x.h===Z.h&&x.g<Z.g)&&(Z=x),f?e.$10x(x):e.push(x))}}}return t?S(Z):[]},$4x:{manhattan:function(H,L){var J=Math.abs(L.x-H.x),c=Math.abs(L.y-H.y);return J+c},diagonal:function(x,f){var a=1,k=Math.sqrt(2),i=Math.abs(f.x-x.x),q=Math.abs(f.y-x.y);return a*(i+q)+(k-2*a)*Math.min(i,q)}},$5x:function(y){y.f=0,y.g=0,y.h=0,y.visited=!1,y.closed=!1,y.parent=null}};return G.prototype.$13x=function(){this.dirtyNodes=[];for(var Z=0;Z<this.nodes.length;Z++)C.$5x(this.nodes[Z])},G.prototype.$6x=function(){for(var P=0;P<this.dirtyNodes.length;P++)C.$5x(this.dirtyNodes[P]);this.dirtyNodes=[]},G.prototype.$7x=function(Z){this.dirtyNodes.push(Z)},G.prototype.neighbors=function(g){var X=[],L=g.x,U=g.y,K=this.grid;return K[L-1]&&K[L-1][U]&&X.push(K[L-1][U]),K[L+1]&&K[L+1][U]&&X.push(K[L+1][U]),K[L]&&K[L][U-1]&&X.push(K[L][U-1]),K[L]&&K[L][U+1]&&X.push(K[L][U+1]),this.diagonal&&(K[L-1]&&K[L-1][U-1]&&X.push(K[L-1][U-1]),K[L+1]&&K[L+1][U-1]&&X.push(K[L+1][U-1]),K[L-1]&&K[L-1][U+1]&&X.push(K[L-1][U+1]),K[L+1]&&K[L+1][U+1]&&X.push(K[L+1][U+1])),X},G.prototype.toString=function(){for(var U=[],L=this.grid,X=0;X<L.length;X++){for(var i=[],O=L[X],n=0;n<O.length;n++)i.push(O[n].weight);U.push(i.join(" "))}return U.join("\n")},x.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},x.prototype.getCost=function(y,P){var Z;if(Z=y&&y.x!=this.x&&y.y!=this.y?1.41421*this.weight:this.weight,P){var f=y;if(!f)return Z;var c=f.parent;return c?Math.abs(c.x+this.x-2*f.x)>1e-5?Z+P:Math.abs(c.y+this.y-2*f.y)>1e-5?Z+P:Z:Z}},x.prototype.$9x=function(){return 0===this.weight},J.prototype={push:function(V){this.content.push(V),this.$11x(this.content.length-1)},pop:function(){var H=this.content[0],m=this.content.pop();return this.content.length>0&&(this.content[0]=m,this.$12x(0)),H},remove:function(U){var t=this.content.indexOf(U),J=this.content.pop();t!==this.content.length-1&&(this.content[t]=J,this.scoreFunction(J)<this.scoreFunction(U)?this.$11x(t):this.$12x(t))},size:function(){return this.content.length},$10x:function(P){this.$11x(this.content.indexOf(P))},$11x:function(W){for(var m=this.content[W];W>0;){var o=(W+1>>1)-1,R=this.content[o];if(!(this.scoreFunction(m)<this.scoreFunction(R)))break;this.content[o]=m,this.content[W]=R,W=o}},$12x:function(N){for(var I=this.content.length,t=this.content[N],s=this.scoreFunction(t);;){var Y,q=N+1<<1,m=q-1,U=null;if(I>m){var z=this.content[m];Y=this.scoreFunction(z),s>Y&&(U=m)}if(I>q){var h=this.content[q],Z=this.scoreFunction(h);(null===U?s:Y)>Z&&(U=q)}if(null===U)break;this.content[N]=this.content[U],this.content[U]=t,N=U}}},{astar:C,Graph:G}});var F=M.Astar.Finder=function(r,p){var K=this;K.gv=r,K.$13x(p),K.refreshMap()};F.prototype={},F.prototype.constructor=F,O.defineProperties(F.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(i){this.gv._astarDebugInfo=i}}}),F.prototype.$13x=function(d){var n=this,g=n.$14x={};d=d||{};var $=d.gridSize||10;g.gridSizeX=d.gridSizeX||$,g.gridSizeY=d.gridSizeY||$,g.rect=d.rect,g.filter=d.filter,g.extendBlocks=d.extendBlocks||3,g.fastOverlap=d.fastOverlap===k?!0:d.fastOverlap,g.nodeRectExtend=d.nodeRectExtend||0,g.diagonal=d.diagonal===k?!0:d.diagonal,g.turnPunish=d.turnPunish===k?.1:d.turnPunish,g.simplify=d.simplify===k?!0:d.simplify,g.toGridCenter=d.toGridCenter===k?!1:d.toGridCenter,g.closest=d.closest===k?!0:d.closest},F.prototype.refreshMap=function(){var N,O=this,m=O.$14x,T=m.gridSizeX,R=m.gridSizeY,i=m.extendBlocks;m.rect?N=m.rect:(N=O.$15x(),M.Default.grow(N,T*i,R*i)),M.Default.grow(N,T,R);var y=Math.floor(N.x/T)*T,c=Math.floor(N.y/R)*R,B=Math.ceil(N.width/T),u=Math.ceil(N.height/R),z=B*T,I=u*R;O.$16x={x:y,y:c,w:z,h:I,gridX:T,gridY:R,xLen:B,yLen:u},O.$17x(),O.$21x()},F.prototype.$15x=function(){var N=this.gv;if(N instanceof M.graph.GraphView)return N.getContentRect();var q,d=M.Default.unionRect;return N.dm().each(function(m){N.isVisible(m)&&m.getRect&&(q=d(q,m.getRect()))}),q},F.prototype.$17x=function(){var r,Z,n,F,S=this,U=S.$16x,E=U.xLen,D=U.yLen;for(r=new Array(E),n=0;E>n;n++)for(r[n]=Z=new Array(D),F=D;F--;)Z[F]=1;var R=S.$14x.filter;for(S.gv.dm().each(function(f){R&&R(f)===!1||(!S._debugInfo||f!==S._debugInfo.grid&&f!=S._debugInfo.path)&&S.$1cw(r,f)}),n=0;E>n;n++)r[n][0]=1,r[n][D-1]=1;for(F=0;D>F;F++)r[0][F]=1,r[E-1][F]=1;S.grid=r;var d=new AStar.Graph(r,{diagonal:S.$14x.diagonal});S.graph=d},F.prototype.$18x=function(Y,f,H,$,u,t,D,k){var z=this.$19x,U=z(H-Y,u-D,$-f,t-k);if(1e-6>=U&&U>=-1e-6)return!1;var P=z(u-Y,u-D,t-f,t-k)/U;if(0>P||P>1)return!1;var G=z(H-Y,u-Y,$-f,t-f)/U;return 0>G||G>1?!1:!0},F.prototype.$19x=function(H,X,O,q){return H*q-X*O},F.prototype.$1aw=function(N,t,o,O){for(var Y=[-(t[1]-N[1]),t[0]-N[0]],Q=Y[0]*(o[0]-N[0])+Y[1]*(o[1]-N[1])>=0,j=0,q=O.length;q>j;j+=2)if(Y[0]*(O[j]-N[0])+Y[1]*(O[j+1]-N[1])>=0===Q)return!1;return!0},F.prototype.$1bw=function(M,P){for(var l,t,h=this,c=0,s=M.length;s>c;c+=2)if(l=c===s-2?0:c+2,t=l===s-2?0:l+2,h.$1aw([M[c],M[c+1]],[M[l],M[l+1]],[M[t],M[t+1]],P))return!1;for(var c=0,s=P.length;s>c;c+=2)if(l=c===s-2?0:c+2,t=l===s-2?0:l+2,h.$1aw([P[c],P[c+1]],[P[l],P[l+1]],[P[t],P[t+1]],M))return!1;return!0},F.prototype.$1cw=function(P,W){if(W.getRect){var $=this,F=W.getRect();M.Default.grow(F,$.$14x.nodeRectExtend);var L,e,y,k,B,h,j,u,N,D,Q,z=$.$1dw({x:F.x,y:F.y}),_=$.$1dw({x:F.x+F.width,y:F.y+F.height}),Y=$.$14x.fastOverlap;if(!Y){var I=W.getCorners();j=[],I.forEach(function(H){j.push(H.x,H.y)}),D=$.$14x.gridSizeX/2,Q=$.$14x.gridSizeY/2}for(e=Math.max(0,z.x),y=Math.min(_.x,P.length-1),B=Math.max(0,z.y),h=Math.min(_.y,P.length?P[0].length-1:-1),L=e;y>=L;L++)for(k=B;h>=k;k++)if(Y)P[L][k]=0;else{N=$.$1ew({x:L,y:k});var r=N.x-D,J=N.x+D,C=N.y-Q,b=N.y+Q;u=[r,C,r,b,J,b,J,C],$.$1bw(j,u)&&(P[L][k]=0)}}},F.prototype.$1dw=function(K,$){var W=this,E=W.$16x,Y=(K.x-E.x)/E.gridX,v=(K.y-E.y)/E.gridY;return $!==!1&&(Y=Math.round(Y),v=Math.round(v)),{x:Y,y:v}},F.prototype.$1ew=function(X){var F=this,u=F.$16x;return{x:X.x*u.gridX+u.x,y:X.y*u.gridY+u.y}},F.prototype.$1fw=function(S){var Q=this,N=Q.$16x,A=N.xLen,B=N.yLen;if(S.x>=0&&S.x<A&&S.y>=0&&S.y<B)return S;var J={x:S.x,y:S.y};return J.x<0?J.x=0:J.x>=A&&(J.x=A-1),J.y<0?J.y=0:J.y>=B&&(J.y=B-1),J},F.prototype.findPath=function(t,o){var p,J,i,E,h=this,N=h.$1dw(t),R=h.$1dw(o);if(i=h.$1fw(N),E=h.$1fw(R),i!==N&&E!==R){var c=h.$16x,y=c.x-c.gridX/2,A=c.y-c.gridY/2,w=y+c.gridX*c.xLen,f=A+c.gridY*c.yLen;if(!(h.$18x(t.x,t.y,o.x,o.y,y,A,w,A)||h.$18x(t.x,t.y,o.x,o.y,w,A,w,f)||h.$18x(t.x,t.y,o.x,o.y,w,f,y,f)||h.$18x(t.x,t.y,o.x,o.y,y,f,y,A)))return[t,o]}i!==N&&(p=!0,N=i),E!==R&&(J=!0,R=E);var v=h.graph.grid[N.x][N.y],F=h.graph.grid[R.x][R.y],z=AStar.search(h.graph,v,F,{closest:h.$14x.closest,punish:h.$14x.turnPunish});if(!z||!z.length)return null;var W=[];W.push(t),p&&W.push(h.$1ew(z[0]));for(var m=1,O=z.length;O-1>m;m++)W.push(h.$1ew(z[m]));if(J)W.push(h.$1ew(z[O-1])),W.push(o);else{var u=z[O-1];R.x!==u.x||R.y!==u.y||h.$14x.toGridCenter?W.push(h.$1ew(u)):W.push(o)}return h.$14x.simplify&&(W=h.simplifyPath(W)),h.$20x=W,h.$21x(),W},F.prototype.debugOn=function(Z){this.debugFlag=!0,this.debugSettings=Z||{},this.$21x()},F.prototype.simplifyPath=function(n){var U=n.length;if(2>=U)return n;var r,s,d=[n[0],n[1]],Y=d[0],m=d[1],A=1e-5;for(r=2;U>r;r++)s=n[r],Math.abs((m.x-Y.x)*(s.y-Y.y)-(m.y-Y.y)*(s.x-Y.x))<A?m=d[d.length-1]=s:(Y=m,m=s,d.push(s));return d},F.prototype.$21x=function(){var $=this;if($.$22x(),this.debugFlag){var b=$.grid;if(b){var o,m=$.gv;if($.debugSettings.$16x!==!1){o=[];for(var Y,t,n,s,A,I=[],F=$.$14x.gridSizeX/2,i=$.$14x.gridSizeY/2,g=b.length,U=g?b[0].length:0,O=1;g-1>O;O++)for(var f=1;U-1>f;f++)b[O][f]||(Y=$.$1ew({x:O,y:f}),t=Y.x-F,n=Y.x+F,s=Y.y-i,A=Y.y+i,o.push({x:t,y:s},{x:t,y:A},{x:n,y:A},{x:n,y:s}),I.push(1,2,2,2,5));var L=new M.Shape;L.s("shape.border.color","rgba(50, 50, 50, 0.2)"),L.s("shape.border.width",1),L.s("shape.background","rgba(200, 50, 100, 0.2)"),L.s("2d.editable",!1),L.s("2d.selectable",!1),L.setPoints(o),L.setSegments(I),$._debugInfo={grid:L},m.dm().add(L)}$.debugSettings.path!==!1&&(o=new M.Shape,$.$20x&&(o.setPoints($.$20x),o.s("shape.border.color","red"),o.s("shape.border.width",1),o.s("2d.editable",!1),o.s("2d.selectable",!1),o.s("shape.background",null),$._debugInfo||($._debugInfo={}),$._debugInfo.path=o,m.dm().add(o)))}}},F.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},F.prototype.$22x=function(){var t=this;if(t._debugInfo){var D=t._debugInfo.grid,F=t._debugInfo.path,E=t.gv;D&&E.dm().remove(D),F&&E.dm().remove(F),t._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);