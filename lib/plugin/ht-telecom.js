!function(E,C){"use strict";var m=ht.AlarmSeverity=function(G,c,Q,R,f){this.value=G,this.name=c,this.nickName=Q,this.color=R,this.displayName=f};ht.Default.def("ht.AlarmSeverity",C,{toString:function(){return this.displayName||this.name}}),function(){m.severities=new ht.List,m._vm={},m._nm={},m._cp=function(q,G){if(q&&G){var y=q.value-G.value;return y>0?1:0>y?-1:0}return q&&!G?1:!q&&G?-1:0},m.each=function(O,y){m.severities.each(O,y)},m.getSortFunction=function(){return m._cp},m.setSortFunction=function(J){m._cp=J,m.severities.sort(J)},m.add=function(P,A,V,Z,d){var e=new m(P,A,V,Z,d);return m._vm[P]=e,m._nm[A]=e,m.severities.add(e),m.severities.sort(m._cp),e},m.remove=function(n){var V=m._nm[n];return V&&(delete m._nm[n],delete m._vm[V.value],m.severities.remove(V)),V},m.CRITICAL=m.add(500,"Critical","C","#FF0000"),m.MAJOR=m.add(400,"Major","M","#FFA000"),m.MINOR=m.add(300,"Minor","m","#FFFF00"),m.WARNING=m.add(200,"Warning","W","#00FFFF"),m.INDETERMINATE=m.add(100,"Indeterminate","N","#C800FF"),m.CLEARED=m.add(0,"Cleared","R","#00FF00"),m.isClearedAlarmSeverity=function(E){return E?0===E.value:!1},m.getByName=function(x){return m._nm[x]},m.getByValue=function(o){return m._vm[o]},m.clear=function(){m.severities.clear(),m._vm={},m._nm={}},m.compare=function(K,f){return m._cp(K,f)}}();var x=ht.AlarmState=function(Q){this._d=Q,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",C,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var d=null;for(var I in this._am)I=m.getByName(I),m.isClearedAlarmSeverity(I)||0!==this.getAcknowledgedAlarmCount(I)&&(d=d?m.compare(d,I)>0?d:I:I);this._haa=d},_c2:function(){var U=null;for(var W in this._nm)W=m.getByName(W),m.isClearedAlarmSeverity(W)||0!==this.getNewAlarmCount(W)&&(U=U?m.compare(U,W)>0?U:W:W);this._hna=U},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var U in this._nm)if(U=m.getByName(U),!m.isClearedAlarmSeverity(U)&&0!==this.getNewAlarmCount(U)&&m.compare(this._hna,U)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var R=this._haa,F=this._hna,j=this._ps;this._hoa=R,m.compare(F,this._hoa)>0&&(this._hoa=F),m.compare(j,this._hoa)>0&&(this._hoa=j)},_c5:function(){var P=this._haa,g=this._hna;this._hta=P,m.compare(g,this._hta)>0&&(this._hta=g)},increaseAcknowledgedAlarm:function(Y,s){if(0!==s){s=s||1;var F=this._am[Y.name]||0;F+=s,this._am[Y.name]=F,this._f()}},increaseNewAlarm:function(i,u){if(0!==u){u=u||1;var z=this._nm[i.name]||0;z+=u,this._nm[i.name]=z,this._f()}},decreaseAcknowledgedAlarm:function(k,M){if(0!==M){M||(M=1);var K=this._am[k.name]||0;if(K-=M,0>K)throw"Alarm count can not be negative";this._am[k.name]=K,this._f()}},decreaseNewAlarm:function(Q,y){if(0!==y){y||(y=1);var M=this._nm[Q.name]||0;if(M-=y,0>M)throw"Alarm count can not be negative";this._nm[Q.name]=M,this._f()}},acknowledgeAlarm:function(y){this.decreaseNewAlarm(y,1),this.increaseAcknowledgedAlarm(y,1)},acknowledgeAllAlarms:function(L){if(L){var r=this.getNewAlarmCount(L);this.decreaseNewAlarm(L,r),this.increaseAcknowledgedAlarm(L,r)}else for(var q in this._nm)this.acknowledgeAllAlarms(m.getByName(q))},_c6:function(){this._aac=0;for(var E in this._am)E=m.getByName(E),this._aac+=this.getAcknowledgedAlarmCount(E)},getAcknowledgedAlarmCount:function(G){return G?this._am[G.name]||0:this._aac},getAlarmCount:function(V){return this.getAcknowledgedAlarmCount(V)+this.getNewAlarmCount(V)},_c7:function(){this._nac=0;for(var W in this._nm)this._nac+=this.getNewAlarmCount(m.getByName(W))},getNewAlarmCount:function(L){return L?this._nm[L.name]||0:this._nac},setNewAlarmCount:function(w,W){this._nm[w.name]=W,this._f()},removeAllNewAlarms:function(F){F?delete this._nm[F]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(z,L){this._am[z.name]=L,this._f()},removeAllAcknowledgedAlarms:function(R){R?delete this._am[R.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(k){if(this._ep||(k=null),this._ps!==k){var p=this._ps;this._ps=k,this._f(),this._d.fp("propagateSeverity",p,k)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(T){var z=this._ep;this._ep=T,this._d.fp("enablePropagation",z,T)&&(T||this.setPropagateSeverity(null))}});var k=ht.AlarmStatePropagator=function(e){this._dataModel=e,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",C,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(j){this._enable!==j&&(this._enable=j,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(R){this.propagate(R)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(S){S.data&&this.propagate(S.data)},handleDataPropertyChange:function(L){if("alarmState"===L.property||"enablePropagation"===L.property)this.propagate(L.data);else if("parent"===L.property){var h=L.oldValue;h&&this.propagate(h),this.propagate(L.data)}},propagate:function(S){S&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(S),this._isPropagating=!1)},propagateToTop:function(j){for(this.propagateToParent(null,j);j&&j.getParent();)this.propagateToParent(j,j.getParent()),j=j.getParent()},propagateToParent:function(Y,S){var O=null;S.getChildren().each(function(H){var b=H.getAlarmState().getHighestOverallAlarmSeverity();m.compare(b,O)>0&&(O=b)}),S.getAlarmState().setPropagateSeverity(O)}}),ht.AlarmStateStatistics=function(f){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(f)},ht.Default.def("ht.AlarmStateStatistics",C,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(w){var z=this._dataModel;z!==w&&(z&&(z.umd(this.handleDataPropertyChange,this),z.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=w,this.reset(),w.md(this.handleDataPropertyChange,this),w.mm(this.handleDataModelChange,this),this.fp("dataModel",z,w))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(D){"alarmState"===D.property&&(this.increase(D.data),this.fireAlarmStateChange())},handleDataModelChange:function(o){"add"===o.kind?(this.increase(o.data),this.fireAlarmStateChange()):"remove"===o.kind?(this.decrease(o.data),this.fireAlarmStateChange()):"clear"===o.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,m.each(function(h){var i=this.getSumInfo(h);this.sumAcked+=i.ackedCount,this.sumNew+=i.newCount,this.sumTotal+=i.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(Z){if(!Z)return this.sumNew;var A=this.getSumInfo(Z);return A.newCount},getAcknowledgedAlarmCount:function(X){if(!X)return this.sumAcked;var b=this.getSumInfo(X);return b.ackedCount},getTotalAlarmCount:function(U){if(!U)return this.sumTotal;var Y=this.getSumInfo(U);return Y.totalCount},getSumInfo:function(s){var Y=this.severtiyMap[s.name];return Y||(Y={},Y.newCount=0,Y.ackedCount=0,Y.totalCount=0,this.severtiyMap[s.name]=Y),Y},decrease:function(G){var C=this.dataMap[G.getId()];C&&(delete this.dataMap[G.getId()],m.each(function(z){var Q=C[z.name],G=this.getSumInfo(z);G.newCount=G.newCount-Q.newCount,G.ackedCount=G.ackedCount-Q.ackedCount,G.totalCount=G.totalCount-Q.totalCount},this))},increase:function(b){if(this.decrease(b),!this._filterFunc||this._filterFunc(b)){var W={},w=b.getAlarmState();this.dataMap[b.getId()]=W,m.each(function(u){var M={};M.newCount=w.getNewAlarmCount(u),M.ackedCount=w.getAcknowledgedAlarmCount(u),M.totalCount=w.getAlarmCount(u),W[u.name]=M;var k=this.getSumInfo(u);k.newCount=k.newCount+M.newCount,k.ackedCount=k.ackedCount+M.ackedCount,k.totalCount=k.totalCount+M.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(T){var m=this._filterFunc;this._filterFunc=T,this.reset(),this.fp("filterFunc",m,T)},getFilterFunc:function(){return this._filterFunc}});var w=ht.Data.prototype;w.getAlarmState=function(){return this._alarmState||(this._alarmState=new x(this))},w=ht.DataModel.prototype,w.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},w.setEnableAlarmStatePropagator=function(M){M!=this.isEnableAlarmStatePropagator()&&(M?(this._alarmStatePropagator=new k(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},w=ht.graph.GraphView.prototype,w.getNote2=function(T){var e=T.getAlarmState().getHighestNewAlarmSeverity();if(e){var w=T.getAlarmState().getNewAlarmCount(e)+e.nickName;return T.getAlarmState().hasLessSevereNewAlarms()&&(w+="+"),w}return T.s("note2")},w.getNote2Background=function(C){var k=C.getAlarmState().getHighestNewAlarmSeverity();return k?k.color:C.s("note2.background")},w.getBodyColor=function(l){var H=l.getAlarmState().getHighestNativeAlarmSeverity();return H?H.color:l.s("body.color")},w.getBorderColor=function(Y){var D=Y.getAlarmState().getPropagateSeverity();return D?D.color:Y.s("border.color")},w=ht.widget.TreeView.prototype,w.getBorderColor=function(w){var Q=w.getAlarmState().getPropagateSeverity();return Q?Q.color:w.s("border.color")},w.getIcon=function(F){return F.getIcon()?"__alarmIcon__":null},w=ht.widget.TreeTableView.prototype,w.getBorderColor=function(F){var H=F.getAlarmState().getPropagateSeverity();return H?H.color:F.s("border.color")},w.getIcon=function(U){return U.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(C){return C.getIcon()}},color:{func:function(_){var a=_.getAlarmState().getHighestNativeAlarmSeverity();return a?a.color:_.s("body.color")}},rect:[0,0,16,16]}]});var X=ht.Style;X["note2.expanded"]=!0,X["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);